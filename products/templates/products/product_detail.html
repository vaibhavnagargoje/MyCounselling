{% extends 'dashboard/core_base.html' %}
{% load static %}

{% block title %}{{ item.name }} | Details{% endblock %}

{% block content %}
<div class="flex-1 ml-64 p-6">
    <!-- Breadcrumb -->
    <nav class="flex mb-6 text-gray-500 text-sm" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a href="{% url 'dashboard:products:products' %}" class="inline-flex items-center hover:text-primary">
                    <i class="fas fa-home mr-2"></i>
                    Plans
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right mx-2 text-gray-400"></i>
                    <span class="capitalize">{{ type }}</span>
                </div>
            </li>
            <li aria-current="page">
                <div class="flex items-center">
                    <i class="fas fa-chevron-right mx-2 text-gray-400"></i>
                    <span class="text-gray-900 font-medium">{{ item.name|truncatechars:30 }}</span>
                </div>
            </li>
        </ol>
    </nav>

    <!-- Main Product Section -->
    <div class="bg-white rounded-xl shadow-lg overflow-hidden mb-8">
        <div class="grid grid-cols-1 lg:grid-cols-2">
            <!-- Left Column: Image -->
            <div class="p-6 bg-gray-50 flex items-center justify-center relative">
                {% if item.image %}
                    <img src="{{ item.image.url }}" alt="{{ item.name }}" class="w-full h-auto max-h-[400px] object-contain rounded-lg shadow-md">
                {% elif item.thumbnail %}
                    <img src="{{ item.thumbnail.url }}" alt="{{ item.name }}" class="w-full h-auto max-h-[400px] object-contain rounded-lg shadow-md">
                {% else %}
                    <div class="w-full h-64 bg-gray-200 rounded-lg flex items-center justify-center text-gray-400">
                        <i class="fas fa-image text-6xl"></i>
                    </div>
                {% endif %}
                
                {% if item.is_popular %}
                <div class="absolute top-6 left-6 bg-warning text-black px-3 py-1 rounded-full font-bold shadow-sm">
                    <i class="fas fa-fire mr-1"></i> Popular Choice
                </div>
                {% endif %}
            </div>

            <!-- Right Column: Details -->
            <div class="p-8">
                <div class="flex items-start justify-between mb-4">
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ item.name }}</h1>
                        {% if is_bundle %}
                            <span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full font-semibold uppercase tracking-wide">
                                {{ item.get_plan_type_display }} Bundle
                            </span>
                        {% else %}
                            <span class="bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded-full font-semibold uppercase tracking-wide">
                                {{ item.exam_type.code|default:"General" }} Product
                            </span>
                        {% endif %}
                    </div>
                    
                    <!-- Share/Wishlist buttons could go here -->
                </div>

                <p class="text-gray-600 text-lg mb-6 leading-relaxed">
                    {{ item.short_description }}
                </p>

                <!-- Pricing Block -->
                <div class="bg-gray-50 rounded-xl p-6 mb-6 border border-gray-100">
                    <div class="flex items-end space-x-3 mb-2">
                        {% if is_bundle %}
                            <span class="text-4xl font-bold text-gray-900">₹{{ item.selling_price }}</span>
                            {% if item.original_price > item.selling_price %}
                                <span class="text-xl text-gray-500 line-through mb-1">₹{{ item.original_price }}</span>
                                <span class="text-success font-bold mb-1 ml-2">{{ item.discount_percentage }}% OFF</span>
                            {% endif %}
                        {% else %}
                            <span class="text-4xl font-bold text-gray-900">₹{{ item.base_price }}</span>
                        {% endif %}
                    </div>
                    <p class="text-sm text-gray-500">Inclusive of all taxes</p>
                </div>

                <!-- Key Highlights -->
                <div class="grid grid-cols-2 gap-4 mb-8">
                    <div class="flex items-center text-gray-700">
                        <div class="w-10 h-10 rounded-full bg-blue-50 flex items-center justify-center text-primary mr-3">
                            <i class="fas fa-calendar-alt"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">Validity</p>
                            <p class="font-semibold">{{ item.validity_days }} Days</p>
                        </div>
                    </div>
                    <div class="flex items-center text-gray-700">
                        <div class="w-10 h-10 rounded-full bg-green-50 flex items-center justify-center text-success mr-3">
                            <i class="fas fa-headset"></i>
                        </div>
                        <div>
                            <p class="text-xs text-gray-500">Support</p>
                            <p class="font-semibold">24/7 Access</p>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex space-x-4">
                    <a href="{% url 'checkout:checkout_page'%}" class="flex-1 bg-primary hover:bg-secondary text-white font-bold py-4 px-6 rounded-xl transition duration-300 shadow-lg transform hover:-translate-y-1 text-center">
                        Buy Now
                    </a>
                    <button class="px-6 py-4 border-2 border-gray-200 rounded-xl hover:border-primary hover:text-primary transition duration-300">
                        <i class="fab fa-whatsapp text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Info Tabs/Sections -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Left: Description & Features -->
        <div class="lg:col-span-2 space-y-8">
            
            <!-- Description -->
            <div class="bg-white rounded-xl shadow-md p-8">
                <h3 class="text-xl font-bold text-gray-900 mb-4 border-b pb-2">Description</h3>
                <div class="prose max-w-none text-gray-600">
                    {% if item.description %}
                        {{ item.description|linebreaks }}
                    {% else %}
                        <p>No detailed description available.</p>
                    {% endif %}
                </div>
            </div>

            <!-- Features List -->
            {% if item.features %}
            <div class="bg-white rounded-xl shadow-md p-8">
                <h3 class="text-xl font-bold text-gray-900 mb-4 border-b pb-2">What You Get</h3>
                <ul class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    {% for feature in item.features %}
                    <li class="flex items-start">
                        <i class="fas fa-check-circle text-success mt-1 mr-3"></i>
                        <span class="text-gray-700">{{ feature }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endif %}

            <!-- Bundle Contents (Only for Bundles) -->
            {% if is_bundle and item.products.all %}
            <div class="bg-white rounded-xl shadow-md p-8">
                <h3 class="text-xl font-bold text-gray-900 mb-4 border-b pb-2">Included in this Package</h3>
                <div class="space-y-4">
                    {% for prod in item.products.all %}
                    <div class="flex items-center p-4 border border-gray-100 rounded-lg hover:bg-gray-50 transition">
                        <div class="w-12 h-12 bg-gray-200 rounded-md flex-shrink-0 overflow-hidden mr-4">
                            {% if prod.thumbnail %}
                                <img src="{{ prod.thumbnail.url }}" class="w-full h-full object-cover">
                            {% else %}
                                <div class="w-full h-full flex items-center justify-center text-gray-400"><i class="fas fa-cube"></i></div>
                            {% endif %}
                        </div>
                        <div class="flex-1">
                            <h4 class="font-semibold text-gray-900">{{ prod.name }}</h4>
                            <p class="text-sm text-gray-500">{{ prod.short_description|truncatechars:60 }}</p>
                        </div>
                        <a href="{% url 'dashboard:products:product_detail' type='product' slug=prod.slug %}" class="text-primary hover:underline text-sm">View</a>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>

        <!-- Right: Related Items -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-xl shadow-md p-6 sticky top-6">
                <h3 class="text-lg font-bold text-gray-900 mb-4">Related Plans</h3>
                <div class="space-y-6">
                    {% for related in related_items %}
                    <div class="group">
                        <a href="{% url 'dashboard:products:product_detail' type=type slug=related.slug %}" class="block">
                            <div class="relative rounded-lg overflow-hidden mb-3 h-32">
                                {% if related.thumbnail %}
                                    <img src="{{ related.thumbnail.url }}" class="w-full h-full object-cover group-hover:scale-105 transition duration-300">
                                {% else %}
                                    <div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400">
                                        <i class="fas fa-image text-2xl"></i>
                                    </div>
                                {% endif %}
                                
                                {% if is_bundle and related.discount_percentage > 0 %}
                                <div class="absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded font-bold">
                                    {{ related.discount_percentage }}% OFF
                                </div>
                                {% endif %}
                            </div>
                            <h4 class="font-semibold text-gray-900 group-hover:text-primary transition line-clamp-2">{{ related.name }}</h4>
                            <div class="flex items-center justify-between mt-2">
                                {% if is_bundle %}
                                    <span class="font-bold text-gray-900">₹{{ related.selling_price }}</span>
                                {% else %}
                                    <span class="font-bold text-gray-900">₹{{ related.base_price }}</span>
                                {% endif %}
                                <span class="text-xs text-gray-500">{{ related.validity_days }} Days</span>
                            </div>
                        </a>
                    </div>
                    {% empty %}
                    <p class="text-gray-500 text-sm">No related plans found.</p>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
